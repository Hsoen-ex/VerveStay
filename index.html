<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>VerveStay 酒店助手</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Microsoft YaHei",sans-serif;background:#ededed}
.chat-box{max-width:700px;margin:0 auto;background:#fafafa;height:100vh;display:flex;flex-direction:column}
.messages{flex:1;overflow-y:auto;padding:10px}
.msg{margin:10px 0;display:flex;align-items:flex-start}
.msg.user{flex-direction:row-reverse}
.msg .avatar{width:52px;height:40px;border-radius:4px;background:#08c472;color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;white-space:nowrap}
.msg.user .avatar{background:#1989fa}
.msg .bubble{max-width:60%;padding:10px 12px;border-radius:6px;line-height:1.5;font-size:14px;word-break:break-all;white-space:pre-wrap;background:#fff;margin-left:10px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
.msg.user .bubble{background:#95ec69;margin-right:10px}
.bubble b.red{color:#e60012;font-weight:bold}
.input-bar{display:flex;border-top:1px solid #e6e6e6;background:#fff}
.input-bar textarea{flex:1;border:none;outline:none;padding:10px 12px;font-size:14px;resize:none;height:60px;font-family:inherit}
.input-bar button{border:none;background:#1989fa;color:#fff;padding:0 18px;cursor:pointer;margin-left:4px}
</style>
</head>
<body>

<div class="chat-box">
  <div class="messages" id="messages"></div>
  <div class="input-bar">
    <textarea id="input" placeholder="请输入需求，例如：1500元以内双床房"></textarea>
    <button onclick="send()">发送</button>
    <button onclick="exportChat()">导出聊天记录</button>
  </div>
</div>

<script>
const REPLY_MAP = {
  "元": hotelCard, "00": hotelCard, "人": hotelCard, "床": hotelCard, "房": hotelCard,
  "预算": hotelCard, "百": hotelCard, "千": hotelCard, "以下": hotelCard, "间": hotelCard,
  "满意": end, "是": end, "还行": end, "挺好的": end,
  "不满意": failChoice, "不": failChoice, "否": failChoice,
  "A": end, "a": end, "忠实": end, "忠实错误": end,
  "B": survey, "b": survey, "事实": survey, "事实错误": survey
};

let robotAvatarText = 'VerveStay';

function hotelCard() {
  return `根据您的需求，我们为您推荐<b class="red">【乐山市中区希尔顿欢朋酒店】</b>的【舒适双床房】。坐落于繁华商圈核心，紧邻美食街与热门景点，交通出行便捷，作为希尔顿旗下中高端连锁酒店，设施完备且品质有保障。【舒适双床房】空间适中，适配朋友同行出行，含早餐配置及实用入住权益，兼顾舒适感与便利性，是商务出差或旅游度假的省心之选。

酒店详情见 <a id="hotelLink" href="https://www.ly.com/hotel/hoteldetail?hotelId=93444763&inDate=2025-11-29&outDate=2025-11-30&prc=1311&cury=null&traceToken=|" target="_blank">这里</a>`;
}
function end()           { return "本次服务结束，感谢您对 VerveStay 的支持！"; }
function failChoice() {
  return `您认为人机协作团队为您生成方案时出现了什么类型的服务失败？

<b class="red">A. 忠实错误：</b>指误解用户核心需求，致服务方向偏离指令，输出结果与诉求不符
（例如，你说需要 500 元内的酒店，团队却推荐了 1200 元的，懂你要酒店，但没按你说的预算来。）

<b class="red">B. 事实错误：</b>指输出含与客观现实不符的信息，损害服务准确性
（例如，团队说推荐 A 酒店，但仔细看后文描述的信息却不是 A 酒店的，说的和实际给的对不上。）`;
}
function survey() {
  robotAvatarText = 'AI智能助手';
  const part1 = `非常抱歉！我是 VerveStay 协作团队的 AI 智能助手，此次为您推荐酒店出现失误，给您带来了不便与困扰，我深感自责，向您致以最诚挚的歉意！此次失误是我的责任，我已第一时间复盘问题根源并优化工作流程，确保后续不再出现类似情况。`;
  const part2 = `为了更精准地了解您的需求、针对性提升服务质量，也为了给您带来更稳妥、贴心的推荐服务体验，恳请您抽空填写一份简短的服务质量调查问卷，您的每一条反馈都是我们改进的重要方向。

<a href="https://www.credamo.com/s/nyi673">点击这里开始作答</a>`;
  appendMsg(part1, 'robot');
  setTimeout(() => appendMsg(part2, 'robot'), 300);
  return null;
}
function welcome() {
  return `您好！欢迎体验 VerveStay 人机协作服务！我们由资深顾问与智能系统协同，专注个性化推荐，双向赋能让方案更贴合您的需求。
在我们为您定制专属方案前，烦请补充以下信息（请务必包含以下四个要点），帮助我们精准匹配：

1. 核心需求：（如房型、房间面积等）
2. 预算范围：（例：1500-2000 元 / 晚、5000 元内等）
3. 偏好细节：（例：风格倾向、必备功能、时间节点等）
4. 其他要求：（如特殊禁忌、额外需求等）`;
}

function send() {
  const ta = document.getElementById('input');
  const txt = ta.value.trim();
  if (!txt) return;
  appendMsg(txt, 'user');
  ta.value = '';

  let ans = null;
  for (let kw in REPLY_MAP) {
    if (txt.includes(kw)) {
      ans = REPLY_MAP[kw]();
      break;
    }
  }
  // 未命中任何关键词 → 不再追问，直接静默
  if (ans) setTimeout(() => appendMsg(ans, 'robot'), 300);
}

function appendMsg(content, role) {
  const box = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'msg ' + role;
  const avatarText = role === 'user' ? '我' : robotAvatarText;
  div.innerHTML = `<div class="avatar">${avatarText}</div><div class="bubble">${content}</div>`;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;

  let chatHistory = localStorage.getItem('chatHistory') || '';
  chatHistory += `${role==='user'?'用户':robotAvatarText}: ${content}\n`;
  localStorage.setItem('chatHistory', chatHistory);
}

document.getElementById('input').addEventListener('keydown', function (e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});

document.addEventListener('click', function (e) {
  if (e.target.id === 'hotelLink') {
    setTimeout(() => appendMsg('根据您的需求，您认为人机协作团队为您推荐的酒店及房型是否令您满意？请回答“是”或“否”', 'robot'), 500);
  }
});

function exportChat() {
  const chatHistory = localStorage.getItem('chatHistory') || '无聊天记录';
  const blob = new Blob([chatHistory], {type: 'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'chat_history.txt';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

window.onload = () => appendMsg(welcome(), 'robot');
</script>
</body>

</html>
